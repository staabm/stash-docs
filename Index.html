

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Stash &mdash; Stash 0.9.5 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.9.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="Stash 0.9.5 documentation" href="index.html" />
    <link rel="next" title="Usage" href="Usage.html" />
    <link rel="prev" title="Stash Documentation" href="Contents.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="Usage.html" title="Usage"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="Contents.html" title="Stash Documentation"
             accesskey="P">previous</a> |</li>
        <li><a href="Contents.html">Stash 0.9.5 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="stash">
<h1>Stash<a class="headerlink" href="#stash" title="Permalink to this headline">¶</a></h1>
<p>Stash makes it easy to speed up your code by caching the results of expensive functions or code. Certain actions, like database queries or calls to external APIs, take a lot of time to run but tend to have the same results over short periods of time. This makes it much more efficient to store the results and call them back up later.</p>
<div class="section" id="features">
<h2>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h2>
<ul>
<li><dl class="first docutils">
<dt><em>Stores all PHP Datatypes</em></dt>
<dd><p class="first last">Stash can store all of the php native datatypes- integers, booleans, null, strings, arrays and objects that can be serialized.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><em>Hierarchal Cache</em></dt>
<dd><p class="first last">Stored items can be nested, like the folders of a filesystem. This allows for related items to be groups together and erased when changed. Storing a user&#8217;s basic information can be nested &#8216;users/userId/info&#8217;, allow all of the user&#8217;s information to be removed quite easily.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><em>Interchangeable Back Ends</em></dt>
<dd><p class="first last">Stash can use a number of different storage engines to persist cache items between requests. Current handlers include Filesystem, APC, Memcached, and Sqlite handlers.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><em>Staggered Handlers</em></dt>
<dd><p class="first last">It occasionally makes sense to use multiple backends- for example, you may have a small amount of memory to allot but a large piece of filesystem, in which case using APC and the FileSystem handler together is an ideal solution. Stash allows you to do this using the special backend, MultiHandler, which can take an unlimited number of handlers.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><em>Stampede Protection</em></dt>
<dd><p class="first last">When a particularly expensive to generate item misses it can cause a chain reaction- the system slows down as it generates the cache, but the longer it takes the more processes that miss and start regenerating it. Stash gives the developer the ability to limit cache regeneration to a single process, as well as an assortment of ways to handle misses.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><em>Regenerates Before Expiration</em></dt>
<dd><p class="first last">Stash gives developers the option to regenerate a cached item before it misses, making sure that up to data is always available while limiting expensive code to running one instance at a time.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><em>Automatic Memoization</em></dt>
<dd><p class="first last">Even though cache handlers are designed to be fast  it is still possible to further increase performance by keeping a copy of previous cache hits in the script&#8217;s local memory. This technique allows the cache to run even without a backend, allowing data that is picked up multiple times in a single request to be cached even without a persistence layer behind it.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><em>Distributed Cache Misses</em></dt>
<dd><p class="first last">In order to reduce sudden spikes on a system Stash alters the expiration times by lowering the cache age a random amount, thus distributing the cache hits over a period of time.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><em>Optimized Data Encoding</em></dt>
<dd><p class="first last">Care is taken to use the fastest possible encoding and decoding functions when storing data, with the preference being to store things in their native data type. Serialization is reserved only for objects or deep multidimensional arrays where breaking down each component individually would be too long.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><em>Unit Tested</em></dt>
<dd><p class="first last">Every handler, class and wrapper is extensively tested. This includes using a variety of datatypes and ranges in order to ensure that the data you put in is the data you get it.</p>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="installing">
<h2>Installing<a class="headerlink" href="#installing" title="Permalink to this headline">¶</a></h2>
<p>Stash can be downloaded from <a class="reference external" href="https://github.com/tedivm/Stash">Github</a> or through <a class="reference external" href="http://pear.tedivm.com/">tedivm&#8217;s pear channel</a>.</p>
</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>Stash functions as a key-value store: you place things into the cache using a key and you retrieve them using the same key.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="nv">$stash</span> <span class="o">=</span> <span class="nv">$pool</span><span class="o">-&gt;</span><span class="na">getCache</span><span class="p">(</span><span class="s1">&#39;fruit&#39;</span><span class="p">);</span>
<span class="nv">$stash</span><span class="o">-&gt;</span><span class="na">store</span><span class="p">(</span><span class="s1">&#39;apple&#39;</span><span class="p">);</span>

<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$stash</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">());</span>
<span class="c1">// string(6) &quot;apples&quot;</span>
</pre></div>
</div>
<p>This works between requests as well.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// First Request</span>
<span class="nv">$stash</span> <span class="o">=</span> <span class="nv">$pool</span><span class="o">-&gt;</span><span class="na">getCache</span><span class="p">(</span><span class="s1">&#39;fruit&#39;</span><span class="p">);</span>
<span class="nv">$stash</span><span class="o">-&gt;</span><span class="na">store</span><span class="p">(</span><span class="s1">&#39;apple&#39;</span><span class="p">);</span>

<span class="c1">// Second Request</span>
<span class="nv">$stash</span> <span class="o">=</span> <span class="nv">$pool</span><span class="o">-&gt;</span><span class="na">getCache</span><span class="p">(</span><span class="s1">&#39;fruit&#39;</span><span class="p">);</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$stash</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">());</span>
<span class="c1">// string(6) &quot;apples&quot;</span>
</pre></div>
</div>
<p>Putting this together with the rest of Stash allows for a simple yet flexible way to speed up scripts by reusing data.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">function</span> <span class="nf">getUserInfo</span><span class="p">(</span><span class="nv">$userId</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$pool</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cachePool</span><span class="p">;</span>

    <span class="c1">// Get a Stash object from the cache pool.</span>
    <span class="nv">$stash</span> <span class="o">=</span> <span class="nv">$pool</span><span class="o">-&gt;</span><span class="na">getCache</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="nv">$userId</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">);</span>

    <span class="c1">// Get the date from it, if any happens to be there.</span>
    <span class="nv">$userInfo</span> <span class="o">=</span> <span class="nv">$stash</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>

    <span class="c1">// Check to see if the cache missed, which could mean that it either didn&#39;t exist or was stale.</span>
    <span class="k">if</span><span class="p">(</span><span class="nv">$stash</span><span class="o">-&gt;</span><span class="na">isMiss</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="c1">// Run the relatively expensive code.</span>
        <span class="nv">$userInfo</span> <span class="o">=</span> <span class="nx">loadUserInfoFromDatabase</span><span class="p">(</span><span class="nv">$userId</span><span class="p">);</span>

        <span class="c1">// Store the expensive code so the next time it doesn&#39;t miss.</span>
        <span class="nv">$stash</span><span class="o">-&gt;</span><span class="na">store</span><span class="p">(</span><span class="nv">$userInfo</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$userInfo</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">saveUserInfo</span><span class="p">(</span><span class="nv">$userId</span><span class="p">,</span> <span class="nv">$infoArray</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Save the data- dumped behind a function just for the example.</span>
    <span class="nx">saveDataToDatabase</span><span class="p">(</span><span class="nv">$userId</span><span class="p">,</span> <span class="nv">$infoArray</span><span class="p">);</span>

    <span class="c1">// Clear out the now invalid data from the cache.</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cachePool</span><span class="o">-&gt;</span><span class="na">clear</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="nv">$userId</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For an in-depth look at using Stash take a look at <a class="reference internal" href="Usage.html"><em>Usage</em></a> and <a class="reference internal" href="Handlers.html"><em>Handlers</em></a>.</p>
</div>
<div class="section" id="license">
<h2>License<a class="headerlink" href="#license" title="Permalink to this headline">¶</a></h2>
<p>Stash is licensed under the New BSD License. This means you are free to use it in any of your projects, proprietary or open source. While you aren&#8217;t obligated to contribute back, any bug fixes or enhancements are appreciated &#8211; besides, getting your code into the main branch is so much easier than maintaining your own fork.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<h3><a href="Contents.html">Table Of Contents</a></h3>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="">Stash</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#features">Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installing">Installing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example">Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#license">License</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="Handlers.html">Handlers</a></li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/Index.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="Usage.html" title="Usage"
             >next</a> |</li>
        <li class="right" >
          <a href="Contents.html" title="Stash Documentation"
             >previous</a> |</li>
        <li><a href="Contents.html">Stash 0.9.5 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Robert Hafner.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>